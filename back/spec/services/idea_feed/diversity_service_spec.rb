# frozen_string_literal: true

require 'rails_helper'

describe IdeaFeed::DiversityService do
  subject(:service) { described_class.new }

  describe '#generate_list' do
    let!(:ideas) do
      [
        create(:idea, title_multiloc: { 'en' => 'We want more trees' }),
        create(:idea, title_multiloc: { 'en' => 'Increase the amount of green in the city' }),
        create(:idea, title_multiloc: { 'en' => 'Nobody can afford a house' })
      ]
    end
    let(:user) { create(:user) }

    before do
      # Correct embeddings for these ideas
      create(:embeddings_similarity, embeddable: ideas[0], embedded_attributes: 'title',
        embedding: [-0.0102005005, 0.008422852, 0.026687622, 0.028945923, 0.0034828186, 0.03274536, 0.008911133, -0.023345947, 0.009162903, -0.018249512, -0.053955078, 0.009170532, 0.0067977905, 0.016159058, -0.030914307, 0.026992798, 0.022720337, 0.008049011, 0.0063095093, -0.025970459, -0.015144348, 0.0184021, 0.044036865, 0.022399902, -0.02810669, -0.004512787, -0.009010315, 0.02633667, -0.030166626, -0.06591797, -0.01940918, 0.028686523, 0.06695557, 0.01977539, -0.038330078, -0.04837036, -0.02935791, -0.06951904, -0.02935791, 0.07342529, -0.032165527, 0.0113220215, 0.007144928, 0.043640137, 0.029876709, -0.008277893, 0.0009384155, -0.0055160522, -0.0013561249, 0.03778076, 0.017440796, 0.0011882782, 0.015533447, 0.011039734, 0.013381958, 0.0077934265, 0.045715332, 0.016799927, -0.0055007935, 0.03186035, 0.007850647, -0.033050537, -0.048950195, -0.0038776398, 0.06530762, 0.08129883, 0.044769287, 0.03692627, 0.012680054, 0.006580353, 0.030914307, 0.014007568, 0.014930725, -0.005744934, -0.055267334, 0.006778717, 0.033691406, 0.059570312, 0.05517578, 0.039154053, -0.0143585205, 0.015289307, 0.047180176, 0.040252686, -0.026947021, -0.00086832047, -0.049835205, 0.023651123, -0.003271103, 0.026062012, 0.01461792, 0.020065308, 0.040283203, 0.0149383545, -0.018463135, 0.004421234, -0.051818848, -0.006629944, -0.0071029663, -0.033233643, 0.009521484, -0.037078857, -0.01374054, 0.04168701, -0.025253296, 0.023132324, -0.039367676, -0.012199402, -0.030838013, -0.019866943, 0.038391113, 0.019378662, 0.0067329407, -0.00970459, 0.0060195923, -0.089904785, 0.0038280487, 0.020904541, -0.020111084, 0.052490234, 0.038330078, -0.011688232, -0.04107666, 0.0049209595, -0.032806396, -0.059753418, 0.005683899, -0.05026245, 0.016921997, 0.013801575, -0.03137207, 0.024795532, 0.003929138, 0.0068130493, 0.00793457, 0.02734375, 0.017745972, -0.036102295, 0.050354004, 0.062438965, -0.008148193, 0.035125732, -0.017227173, 0.002702713, 0.016662598, -0.010910034, 0.07055664, 0.06829834, 0.012817383, 0.017059326, 0.018585205, 0.03277588, 0.039154053, 0.024169922, 0.020233154, 0.022979736, 0.04876709, -0.06854248, 0.01550293, 0.0035514832, 0.0043258667, -0.016815186, -0.010612488, -0.022415161, -0.009254456, -0.03265381, 0.037506104, -0.004207611, 0.0209198, -0.024780273, 0.02305603, 0.030838013, 0.07562256, 0.018692017, 0.014434814, 0.0072364807, 0.0046195984, 0.027786255, 0.028060913, -0.04736328, 0.017150879, 0.0071868896, -0.025039673, 0.025360107, -0.0034809113, 0.030670166, 0.004573822, 0.0035552979, 0.016433716, 0.03692627, -0.014022827, -0.03930664, -0.06463623, 0.014289856, -0.046722412, 0.037231445, 0.014602661, -0.045806885, 0.03353882, 0.061065674, 0.025115967, -0.037506104, -0.015930176, 0.002981186, 0.030395508, 0.01864624, 0.0063095093, -0.055389404, -0.012214661, 0.0065231323, -0.0068626404, 0.010131836, -0.0025119781, -0.010139465, 0.026428223, 0.013977051, 0.03866577, 0.08618164, -0.00023543835, 0.028656006, 0.0054855347, -0.015991211, 0.002073288, -0.04849243, -0.0262146, -0.0102005005, 0.010444641, -0.03125, 0.002117157, -0.045013428, -0.02218628, -0.011222839, 0.046905518, -0.009269714, 0.07739258, 0.008468628, 0.026351929, -0.029876709, 0.0044822693, 0.0040664673, 0.04321289, 0.03640747, -0.016357422, 0.015098572, 0.0473938, -0.019927979, 0.0072021484, -0.020492554, 0.040008545, -0.02128601, -0.0023078918, 0.049224854, 0.011894226, 0.014625549, 0.04849243, -0.0020141602, 0.02507019, -0.023651123, -0.0017910004, -0.024246216, -0.03994751, 0.0015697479, 0.04171753, -0.02166748, -0.031463623, -0.046783447, 0.0035114288, 0.00818634, 0.044403076, 0.045440674, -0.013710022, -0.052886963, -0.025238037, 0.014450073, -0.009742737, 0.016220093, -0.060668945, 0.00806427, -0.04067993, 0.03778076, 0.025756836, 0.017105103, 0.018295288, -0.034484863, -0.066345215, 0.05255127, -0.023605347, 0.008583069, 0.06640625, -0.01802063, 0.044921875, -0.016082764, 0.0008010864, 0.028900146, -0.028579712, 0.017150879, -0.008262634, -0.032073975, -0.022994995, 0.023666382, 0.004005432, 0.028396606, 0.06982422, -0.0019330978, 0.03149414, 0.053710938, -0.05532837, 0.022094727, -0.024047852, -0.02281189, -0.0032577515, 0.010047913, -0.0121536255, -0.0045280457, -0.018157959, 0.03314209, -0.03463745, -0.014411926, -0.005016327, -0.020309448, -0.018310547, -0.008682251, -0.04623413, 0.0082473755, -0.038909912, -0.018554688, 0.0008339882, -0.019454956, 0.030197144, 0.006500244, 0.0046691895, -0.03302002, 0.0059432983, -0.013191223, -0.01737976, -0.025436401, -0.046295166, 0.0076408386, -0.0715332, 0.011199951, -0.04550171, 0.0128479, -0.049591064, 0.04058838, 0.0524292, 0.042907715, 0.0149383545, -0.08782959, -0.0657959, -0.022903442, 0.023834229, 0.00843811, -0.013267517, -0.024993896, -0.023422241, 0.00016820431, -0.013114929, -0.00027561188, -0.028396606, 0.014953613, -0.003753662, 0.019470215, -0.03010559, 0.04345703, 0.02545166, 0.029052734, -0.037078857, 6.455183e-05, -0.02709961, 0.046813965, 0.0060157776, 0.03543091, 0.06506348, 0.01525116, -0.046905518, 0.057678223, -0.015266418, -0.01637268, 0.037872314, -0.04550171, 0.014213562, -0.02772522, 0.035339355, -0.009132385, 0.0345459, 0.00050115585, 0.002494812, -0.023651123, -0.096069336, 0.036834717, 0.06378174, 0.09448242, 0.0036621094, -0.054473877, 0.010757446, 0.039886475, -0.013542175, 0.0025138855, -0.03314209, -0.02168274, 0.023147583, -0.014404297, -0.0046806335, -0.016662598, 0.016845703, 0.01713562, -0.0041275024, 0.007972717, -0.026016235, -0.021591187, -0.041870117, -0.021621704, 0.03729248, -0.012588501, -0.01763916, 0.007293701, -0.0061531067, 0.0435791, -0.053253174, -0.003036499, -0.09161377, -0.052093506, -0.008308411, 0.00038433075, 0.012123108, 0.013191223, 0.037200928, -0.05633545, 0.029190063, -0.0031738281, -0.009048462, 0.0068626404, 0.007980347, -0.008140564, -0.00497818, -0.012931824, -0.05267334, 0.007987976, -0.032958984, 0.029449463, 0.06890869, -0.032043457, 0.012664795, 0.0013980865, 0.04574585, -0.01197052, 0.009376526, -0.007965088, -0.025482178, -0.014541626, -0.026687622, -0.036743164, -0.02279663, -0.005722046, 0.0066452026, 0.06774902, 0.022964478, 0.052825928, -0.015014648, -0.04034424, -0.054901123, -0.0050964355, 0.023712158, -0.054840088, 0.015586853, -0.023635864, -0.0058250427, 0.020248413, 0.013885498, -0.0045318604, -0.030853271, 0.0625, -0.018478394, -0.044525146, 0.053375244, 0.038604736, -0.020553589, 0.010025024, 0.03378296, 0.05819702, -0.013000488, 0.017684937, 0.036621094, 0.009750366, 0.012527466, 0.022842407, 0.026733398, 0.015975952, 0.027023315, 0.018539429, 0.012504578, -0.022384644, -0.016586304, -0.012969971, 0.047058105, 0.0008921623, 0.046081543, -0.039642334, 0.02281189, 0.03579712, 0.06951904, 0.018829346, -0.00015068054, -0.013389587, -0.0031108856, -0.034484863, -0.01626587, 0.00073337555, 0.01977539, 0.016067505, 0.016220093, -0.03427124, -0.03353882, 0.014831543, -0.03225708, -0.02331543, 0.064941406, 0.0020446777, 0.019180298, -0.015945435, -0.002708435, 0.030776978, 0.027633667, 0.010406494, 0.014595032, -0.0013456345, -0.016174316, 0.031280518, -0.033325195, 0.050048828, -0.04837036, -0.051971436, -0.018981934, -0.01864624, -0.0037059784, -0.071899414, -0.008392334, -0.0019083023, 0.021728516, -0.03479004, -0.061645508, -0.006122589, -0.060058594, 0.011543274, 0.002313614, -0.008338928, -0.03778076, -0.019073486, 0.008049011, 0.05923462, -0.046325684, 0.022979736, -0.0178833, -0.027191162, -0.005378723, 0.030136108, -0.033966064, 0.00061655045, 0.025436401, -0.039001465, -0.047821045, -0.082336426, -0.016479492, 0.07623291, -0.0022735596, -0.014198303, -0.06665039, -0.032958984, -0.032684326, -0.00881958, 0.020507812, 0.038726807, 0.00074243546, 0.016906738, 0.0035266876, -0.037078857, 0.021591187, -0.015991211, -0.014205933, -0.0054779053, 0.024765015, 0.003396988, 0.0340271, -0.01121521, 0.0059127808, -0.10632324, 0.0019044876, -0.011764526, -0.031799316, 0.0035552979, 0.004714966, -0.005329132, 0.0030212402, 0.028564453, -0.028503418, 0.016601562, -0.0010347366, -0.003479004, -0.014892578, 0.015991211, -0.0038414001, 0.01285553, -0.020126343, 0.01096344, -0.018112183, -0.00011211634, -0.005016327, 0.0103302, 0.04473877, 0.048736572, 0.014427185, 0.0029296875, 0.021072388, -0.0041999817, -0.011985779, 0.0066452026, -0.0087890625, -0.0022087097, 0.038848877, 0.021102905, -0.019836426, -0.039154053, 0.037628174, 0.009986877, -0.03463745, -0.038909912, 0.02722168, 0.016601562, -0.064819336, -0.05697632, -0.0077819824, -0.018554688, 0.01727295, -0.04019165, -0.04348755, 0.021850586, 0.004501343, -0.036834717, -0.034698486, -0.012145996, 0.007972717, -0.0317688, 0.01689148, -0.019165039, 0.027282715, -0.027511597, -0.0118255615, -0.033935547, -0.017944336, 0.052703857, 0.005962372, 0.04837036, 0.024047852, -0.060150146, 0.004722595, 0.007843018, 0.022537231, 0.074523926, 0.025558472, 0.01007843, 0.0019836426, -0.00033283234, -0.021194458, -0.05633545, -0.0030174255, 0.03652954, -0.03756714, -0.032043457, 0.004558563, -0.07318115, -5.4180622e-05, 0.029571533, 0.013252258, 0.010131836, 0.03704834, 0.01637268, -0.04815674, -0.015625, -0.0340271, -0.03955078, 0.012763977, 0.014533997, -0.038085938, 0.010543823, -0.02229309, 0.03451538, -0.06512451, -0.04663086, 0.012619019, -0.017868042, 0.0029850006, 0.06359863, 0.0029144287, 0.033935547, -0.013801575, 0.05178833, 0.026885986, -0.009590149, -0.041168213, -0.018081665, -0.0059051514, 0.002954483, 0.0068893433, 0.03314209, -0.019226074, -0.024810791, 0.05883789, -0.04434204, -0.036071777, -0.0037574768, 0.019515991, 0.053741455, 0.03543091, -0.0044174194, -0.023742676, 0.01348114, -0.003479004, -0.042785645, -0.028427124, 0.0046424866, 0.030975342, -0.01260376, -0.005844116, -0.068603516, -0.0053520203, -0.0016431808, -0.021621704, -0.0050964355, 0.0033512115, -0.0013580322, 0.0107803345, 0.03137207, 0.032440186, -0.02178955, -0.008216858, -0.04812622, -0.029785156, -0.023803711, 0.06768799, -0.019424438, 0.051757812, 0.022705078, 0.005393982, -0.06896973, -0.0055160522, 0.014572144, -0.013069153, 0.01727295, -0.011672974, -0.00919342, 0.014656067, 0.036621094, -0.0050621033, -0.0027637482, -0.0008778572, 0.009117126, 0.008323669, -0.008911133, -0.0063934326, 0.0043296814, 0.0143585205, -0.025543213, -0.015853882, -0.006668091, -0.028640747, 0.019851685, 0.0012731552, -0.02519226, 0.0055656433, 0.02861023, -0.009567261, 0.0041503906, 0.012191772, 0.02947998, -0.05239868, -0.014259338, 0.033355713, -0.01713562, 0.010879517, 0.013267517, -0.05255127, -0.044891357, 0.043395996, -0.023330688, 0.007537842, -0.03967285, 0.018936157, -0.008216858, 0.020004272, 0.00333786, -0.03086853, -0.015090942, 0.0077705383, -0.017730713, -0.0005493164, -0.03793335, 0.03265381, -0.047698975, -0.028884888, -0.015991211, 0.009719849, -0.01977539, 0.0015354156, -0.004760742, 0.0068206787, -0.016723633, -0.015296936, -0.006111145, 0.008682251, 0.019302368, 0.023452759, 0.025466919, 0.0050849915, 0.024459839, -0.010612488, 0.0011692047, 0.05557251, 0.05328369, 0.017730713, 0.0029773712, -0.032226562, 0.018875122, -0.020843506, -0.0070152283, 0.03933716, -0.038146973, 0.034606934, -0.03451538, 0.022369385, 0.10864258, 0.04159546, 0.013542175, 0.015945435, -0.014419556, -0.0178833, 0.0090408325, -0.0032176971, 0.048187256, 0.017028809, 0.03189087, -0.019134521, -0.03753662, -0.049316406, -0.016174316, 0.06719971, 0.045196533, 0.0211792, 0.06567383, -0.009681702, 0.076660156, -0.0035305023, -0.01763916, 0.03729248, -0.007511139, 0.012062073, -0.03488159, -0.032196045, -0.018798828, 0.027893066, -0.00039458275, -0.031433105, -0.009590149, -0.009170532, 0.016540527, 0.026412964, 0.011062622, -0.034210205, 0.0032367706, 0.015556335, -0.031204224, -0.039215088, 0.010765076, 0.056854248, -0.06555176, 0.06567383, 0.023345947, 0.025482178, -0.014091492, -0.0017023087, 0.03805542, 0.024261475, -0.025756836, -0.01789856, -0.022888184, -0.022903442, -0.005088806, 0.013587952, 0.026794434, -0.019378662, -0.007472992, 0.03768921, -0.0023422241, 0.006378174, 0.0209198, -0.0054893494, -0.022018433, 0.12036133, -0.029434204, -0.071777344, -0.0048561096, -0.053649902, 0.051818848, 0.042114258, -0.022918701, 0.045135498, -0.02748108, 0.036987305, 0.018096924, 0.012893677, 0.012542725, -0.0054016113, 0.049865723, -0.011886597, -0.0051841736, 0.043792725, -0.015014648, 0.037139893, -0.026504517, 0.0009407997, -0.0010614395, -0.015312195, -0.015296936, -0.014091492, -0.008399963, -0.0043945312, 0.023254395, 0.056488037, -0.016281128, -0.021484375, 0.015716553, -0.020233154, 0.0031585693, 0.00088882446, -0.017684937, 0.00011187792, 0.0026664734, 0.001490593, 0.010124207, 0.05999756, 0.015777588, -0.0007920265, 0.017623901, -0.019165039, -0.020019531, -0.02268982, -0.011650085, 0.0022830963, -0.012229919, -0.011291504, -0.040924072, -0.03604126, 0.02418518, 0.03289795, -0.00089120865, -0.042419434, -0.008003235, 0.00043463707, 0.008857727, 0.044525146, -0.050750732, -0.024765015, 0.021896362, 0.018814087, -0.03503418, -0.077819824, 0.0037727356, 0.030776978, -0.0076904297, -0.0076446533, 0.08294678, 0.097717285, 0.012176514, -0.07788086, -0.009132385, -0.023971558, -0.026229858, -0.043273926, -0.0016450882, 0.0692749, 0.002729416, 0.01512146, -0.004169464, 0.026397705, -0.0009088516, -0.0059013367, 0.0446167, -0.0056114197, -0.025436401, -0.001490593, -0.011405945, -0.05239868, -0.010375977, -0.01687622, -0.024307251, 0.008811951, 0.039733887, 0.0068969727, 0.0012426376, 0.053588867, -0.015617371, 0.00055122375, 0.0011911392, -0.05130005, 0.003818512, 0.04626465, 0.032104492, 0.020050049, 0.0054855347, 0.0076065063, -0.01108551, 0.004638672, -0.023452759, -0.01600647, -0.007167816, 0.019241333, -0.02406311, -0.0357666, 0.017303467, -0.05230713, -0.006965637, 0.037384033, 0.04345703, -0.0146484375, -0.02835083]) # rubocop:disable Metrics/CollectionLiteralLength,Layout/LineLength
      create(:embeddings_similarity, embeddable: ideas[1], embedded_attributes: 'title',
        embedding: [0.0028533936, 0.0099487305, 0.0541687, 0.06329346, -0.036590576, 0.024765015, 0.0068206787, -0.0033397675, -0.0007972717, -0.019897461, -0.048950195, -0.014289856, 0.009277344, 0.009773254, -0.025436401, 0.023269653, 0.026046753, -0.024627686, 0.031707764, 0.0022201538, -0.020187378, 0.039367676, 0.049102783, -0.025543213, -0.028060913, 0.025802612, 0.0085372925, -0.0053863525, -0.039367676, -0.062683105, -0.049438477, 0.03152466, 0.05630493, 0.005153656, -0.022399902, -0.046905518, -0.016067505, -0.06774902, -0.026107788, 0.08026123, -0.037353516, 0.027023315, 0.027252197, 0.028045654, 0.011878967, -0.016052246, -0.011131287, -0.019210815, -0.03881836, 0.03717041, 0.0076026917, -0.0051498413, 0.022094727, 0.0113220215, 0.027572632, 0.021057129, 0.018798828, 0.06958008, 0.018875122, 0.044555664, 0.028808594, 0.003686905, -0.030578613, 0.010726929, 0.03970337, 0.050598145, 0.040496826, 0.0234375, 0.0024719238, 0.0012321472, 0.021087646, 0.010559082, 0.03111267, -0.018692017, -0.042907715, -0.0074310303, 0.026535034, 0.061798096, 0.045318604, 0.047180176, -0.0065193176, 0.014137268, 0.07128906, 0.0046653748, 0.0053596497, 0.026870728, 0.00957489, 0.016601562, 0.011138916, 0.0075645447, 0.016448975, 0.030944824, 0.05239868, 9.453297e-05, 0.005870819, -0.010498047, -0.0041656494, -0.04324341, 0.008575439, -0.0491333, 0.0055503845, -0.034423828, -0.027404785, 0.032348633, -0.0206604, 0.04989624, -0.02394104, -0.005466461, -0.052825928, -0.048217773, 0.017196655, -0.008132935, 0.038848877, -0.031066895, 0.024856567, -0.04220581, 0.022491455, 0.031036377, -0.023223877, 0.074401855, -0.00096797943, 0.010902405, -0.047729492, -0.016845703, -0.02935791, -0.009269714, 0.0032405853, -0.02998352, -0.004169464, 0.011383057, -0.014701843, 0.03012085, 0.009010315, 0.0045394897, 0.0104599, 0.061553955, 0.022262573, -0.023498535, 0.0592041, 0.046783447, 0.0044937134, 0.010040283, -0.0037899017, 0.01108551, 0.014976501, -0.013961792, 0.045532227, 0.05807495, 0.0043296814, -0.015174866, 0.021148682, 0.022705078, 0.036071777, -0.030227661, 0.0014896393, 0.023162842, 0.06945801, -0.057556152, 0.035339355, 0.0023269653, 0.020904541, 0.0036888123, -0.016204834, -0.017684937, -0.011856079, -0.033691406, 0.048736572, -0.0009994507, 0.03173828, 0.0496521, 0.018707275, 0.024856567, 0.06921387, 0.027618408, 0.022369385, -0.0335083, -0.0022583008, 0.015792847, 0.003791809, -0.033721924, 0.021392822, -0.023742676, -0.01499939, 0.02558899, -0.009544373, 0.016067505, -0.005622864, -0.03201294, 0.035583496, 0.07556152, 0.009651184, 0.003206253, -0.07513428, -0.013496399, -0.06536865, 0.039764404, 0.01739502, -0.03366089, 0.034362793, 0.03656006, 0.05419922, -0.022216797, -0.00623703, 0.007259369, 0.010284424, -0.010955811, 0.001953125, -0.0013799667, -0.052734375, 0.027572632, -0.018447876, -0.013511658, -0.019805908, -0.003501892, 0.022827148, 0.015220642, 0.018325806, 0.066833496, 0.003047943, -0.005016327, 0.048706055, -0.0335083, 0.0025177002, -0.032562256, -0.03656006, -0.009376526, 0.013679504, -0.016036987, -0.011451721, -0.042816162, -0.015655518, -0.009277344, 0.046569824, -0.011398315, 0.06726074, 0.008926392, 0.052246094, -0.01826477, 0.013328552, 0.0008120537, 0.040252686, 0.060058594, -0.004146576, -0.00075531006, 0.024932861, 0.004055023, -0.016464233, -0.054229736, 0.03338623, -0.001958847, -0.001496315, 0.052459717, 0.01133728, 0.014862061, 0.063964844, 0.03878784, 0.048980713, 0.044525146, 0.038848877, -0.004776001, -0.076416016, -0.015060425, 0.04208374, -0.016967773, -0.04196167, -0.015701294, 0.015548706, 0.007949829, 0.044921875, 0.03765869, 0.030395508, -0.025421143, -0.030929565, 0.04284668, -0.0045318604, 0.031341553, -0.04849243, 0.029678345, -0.028305054, 0.06524658, 0.03225708, 0.001039505, 0.0103302, -0.05718994, -0.06097412, 0.070251465, -0.04373169, -0.0013332367, 0.055633545, -0.011878967, 0.057678223, -0.010185242, 0.03564453, 0.046569824, 0.02166748, -0.009544373, -0.015052795, -0.016204834, 0.01058197, 0.011566162, -0.017242432, 0.05114746, 0.031280518, -0.02986145, 0.062561035, 0.048950195, -0.078552246, 0.022567749, -0.037628174, -0.019104004, -0.00068092346, -0.0038814545, 0.0076026917, 0.0014066696, -0.025665283, 0.03555298, -0.0075798035, -0.046417236, -0.017654419, 0.0023880005, 0.0008277893, -0.02848816, -0.048095703, -0.004585266, -0.004722595, 0.016220093, -0.009490967, 0.0025749207, 0.010475159, -0.011070251, 0.0010471344, 0.008102417, 0.022735596, -0.019882202, 0.018753052, -0.0014781952, -0.008956909, -0.006038666, -0.03793335, 0.016296387, -0.02935791, 0.005897522, -0.04333496, 0.017318726, 0.016555786, 0.029373169, -0.007255554, -0.08831787, -0.024383545, -0.00020694733, 0.0501709, 0.02154541, -0.012550354, -0.03265381, -0.028244019, -0.005279541, -0.022262573, -0.0016975403, -0.026611328, 0.029678345, -0.0045280457, 0.028396606, -0.02658081, 0.009300232, 0.027450562, 0.016967773, -0.031402588, 0.0011119843, -0.034362793, 0.05419922, -0.0011100769, 0.036621094, 0.047790527, -0.0014429092, -0.026794434, 0.04510498, -0.010002136, -0.08074951, -0.011390686, -0.019042969, 0.055389404, -0.014373779, -0.00504303, -0.012390137, 0.03652954, 0.007637024, -0.0075302124, -0.022888184, -0.038085938, 0.049865723, 0.060180664, 0.05041504, 0.013641357, -0.02671814, -0.015853882, 0.018356323, -0.015625, 0.020492554, -0.051574707, -0.02645874, 0.041503906, -0.021514893, 0.02029419, -0.012031555, 0.015823364, 0.05697632, 0.010513306, -0.009796143, -0.01727295, -0.0362854, -0.028518677, -0.035614014, 0.0051116943, 0.0035209656, -0.016815186, 0.0034294128, 0.039276123, 0.034942627, -0.01991272, 0.00630188, -0.045410156, -0.035980225, 0.02986145, 0.02659607, -0.013671875, -0.030838013, 0.035247803, -0.024368286, 0.032165527, 0.007843018, 0.014007568, 0.0061454773, 0.0029888153, 0.012619019, 0.015075684, 0.004295349, -0.027923584, 0.013153076, -0.03111267, -0.0052604675, 0.05508423, -0.06555176, 0.030410767, 0.0073280334, 0.05899048, 0.012550354, -0.020111084, -0.008140564, -0.01675415, -0.00541687, -0.027252197, -0.028030396, -0.034210205, -0.008712769, 0.0077323914, 0.053222656, 0.044311523, 0.04852295, -0.042236328, -0.04776001, -0.08673096, -0.00062417984, 0.041748047, -0.057434082, -0.025894165, 0.021347046, 0.03414917, 0.013259888, -0.021972656, 0.019927979, -0.022949219, 0.042663574, -0.027801514, -0.01776123, 0.026626587, 0.0077400208, -0.035217285, 0.029800415, 0.0035362244, 0.005847931, -0.054107666, -0.0015869141, 0.060180664, 0.0043182373, 0.02507019, -0.0036888123, 0.03894043, -0.0008263588, 0.04699707, 0.012145996, 0.0317688, -0.005004883, -0.033050537, -0.009796143, 0.038146973, -0.03375244, 0.044799805, -0.027420044, 0.035125732, 0.015625, 0.08514404, 0.0034980774, 0.0015802383, -0.0001502037, -0.0049476624, -0.000395298, 0.008651733, -0.020370483, 0.007949829, -0.009239197, 0.011871338, 0.0010328293, -0.053649902, 0.033691406, -0.04473877, -0.041534424, 0.038146973, 0.054840088, 0.015342712, -0.014221191, 0.0184021, 0.025680542, 0.0037269592, 0.03274536, 0.052093506, -0.010292053, -0.028167725, -0.021911621, -4.7504902e-05, 0.062438965, -0.052459717, -0.04525757, -0.039916992, -0.008377075, -0.0013904572, -0.026443481, 0.006958008, -0.026626587, 0.032348633, 0.0077438354, -0.04748535, -0.00046896935, -0.045166016, 0.03466797, 0.002111435, -0.028320312, -0.004650116, -0.048950195, -0.019439697, 0.0031147003, -0.033721924, 0.01335907, -0.023925781, -0.025787354, 0.00020444393, 0.013633728, -0.022247314, -0.0018730164, 0.015281677, -0.018173218, -0.050109863, -0.0513916, -0.009292603, 0.059448242, -0.0022239685, -0.010826111, -0.036590576, -0.019714355, 0.0008010864, -0.051635742, 0.037109375, 0.025253296, 0.013702393, -0.016555786, -0.0137786865, -0.021575928, 0.045684814, 0.0038547516, -0.006324768, 0.003255844, 0.030380249, -0.0067977905, 0.023635864, -0.0057373047, -0.003419876, -0.097961426, -0.0016517639, -0.016647339, 0.0032176971, 0.011482239, 0.04675293, 0.00541687, 0.006137848, 0.014175415, -0.05480957, 0.026611328, -0.005393982, 0.019897461, -0.0009274483, 0.0072784424, 0.02394104, 0.021911621, -0.001080513, 0.011955261, -0.016738892, -0.0178833, 0.017684937, -0.003206253, 0.02494812, -0.016967773, 0.00012540817, -0.030166626, 0.03857422, 0.008033752, -0.016204834, -0.006580353, -0.005168915, 0.027008057, 0.03463745, 0.0158844, -0.008720398, -0.02331543, 0.014846802, -0.006816864, -0.025421143, -0.018417358, 0.012199402, 0.024810791, -0.016647339, 0.0041770935, 0.010192871, -0.004005432, 0.013412476, -0.0063819885, -0.010948181, 0.061767578, -0.018081665, -0.081726074, -0.039611816, 0.0027217865, 0.0039711, 0.01953125, 0.0045394897, 0.0006570816, 0.006313324, -0.040740967, -0.04345703, -0.0033493042, -0.03805542, 0.07952881, -0.0035686493, 0.04888916, 0.09082031, -0.084106445, 0.005256653, -0.025909424, -0.0029964447, 0.01687622, -0.009254456, 0.017944336, -0.000995636, -0.008544922, 0.0039520264, -0.015541077, -0.01272583, 0.0579834, -0.030303955, -0.0062942505, 0.0028820038, -0.056121826, -0.017837524, 0.038024902, 0.026351929, 0.028533936, 0.04437256, -0.01272583, -0.0513916, -0.039642334, -0.010154724, -0.041137695, -6.198883e-05, 0.029266357, -0.037078857, 0.014457703, 0.0063552856, 0.016540527, -0.051208496, -0.03515625, 0.019210815, -0.005168915, 0.0009379387, 0.042877197, 0.0027618408, 0.020858765, -0.010093689, 0.037475586, 0.04232788, 0.011260986, -0.04144287, -0.019805908, -0.0033683777, 0.016082764, 0.0124435425, 0.03829956, -0.016830444, -0.042938232, 0.04888916, -0.05218506, -0.0102005005, -0.0038547516, 0.023254395, 0.06945801, 0.0048561096, -0.011634827, 0.007286072, 0.013305664, 0.015365601, 0.0020141602, -0.010093689, 0.013183594, 0.01008606, -0.020553589, -0.018585205, -0.055999756, 0.0066719055, -0.008804321, -0.013618469, 0.0009822845, -0.01689148, 0.0074310303, -0.003835678, 0.024276733, 0.016098022, 0.005138397, -0.014030457, -0.01864624, -0.042419434, -0.05407715, 0.11328125, -0.021011353, 0.05706787, -0.00037050247, 0.008110046, -0.054840088, 0.03237915, 0.008422852, -0.015258789, 0.025527954, -0.00819397, -0.02381897, 0.03201294, 0.06359863, -0.00299263, -0.0016880035, -0.004512787, 0.0015392303, 0.0102005005, -0.008079529, -0.015319824, 0.017868042, 0.023971558, -0.019927979, -0.028686523, -0.038238525, -0.049591064, 0.013252258, 0.034820557, -0.016311646, -0.011558533, 0.003419876, -0.036590576, -0.007247925, 0.0041007996, 0.020767212, -0.012809753, 0.018188477, 0.05090332, -0.058898926, 0.016799927, 0.01071167, -0.05923462, -0.046447754, 0.045898438, -0.037475586, -0.017227173, -0.018569946, 0.05618286, -0.014717102, -0.007484436, 0.016067505, -0.028656006, 0.0067443848, -0.022735596, -0.012504578, -0.02470398, -0.010528564, 0.017318726, -0.07110596, -0.016464233, -0.055480957, -0.039031982, -0.038848877, 0.0028419495, 0.0077438354, 0.008682251, -0.02658081, 0.008796692, 0.046447754, 0.033081055, 0.014907837, 0.022872925, 0.019729614, 0.04522705, 0.012420654, -0.014312744, 0.002696991, 0.05178833, 0.04296875, 0.011116028, 0.035888672, -0.004348755, -0.0039634705, -0.030929565, -0.022216797, 0.008628845, -0.031143188, 0.03753662, -0.016540527, -0.01146698, 0.042175293, 0.050750732, 0.014503479, 0.013328552, -0.024902344, 0.013038635, -0.017242432, 0.00554657, 0.06591797, 0.015808105, 0.009880066, -0.019515991, -0.006248474, -0.009155273, 7.647276e-05, 0.04714966, 0.025878906, -0.014297485, 0.076293945, -0.030456543, 0.042816162, -0.01852417, -0.0095825195, 0.089660645, -0.021865845, -0.029083252, -0.019226074, -0.0008840561, -0.0001167655, -0.009063721, 0.00111866, -0.0036201477, -0.0033397675, 0.018218994, 0.016998291, 0.03050232, 0.014259338, 0.005168915, 0.0051956177, 0.0082092285, -0.053375244, 0.007160187, -0.0038795471, 0.081604004, -0.07543945, 0.0016088486, -0.0038452148, 0.013046265, -0.040039062, -0.025970459, 0.00674057, 0.06329346, -0.014228821, -0.03778076, -0.03277588, -0.040863037, -0.012374878, -0.0030879974, 0.027694702, -0.020584106, 0.013191223, 0.0287323, 0.0022468567, 0.0071525574, 0.007335663, -0.020462036, -0.0085372925, 0.0947876, -0.022720337, -0.062286377, -0.005252838, -0.049743652, 0.026870728, 0.0418396, -0.021148682, 0.0211792, -0.019744873, 0.02746582, 0.026870728, 0.031677246, -0.0002784729, -0.040985107, 0.058685303, -0.032562256, 0.013153076, 0.024383545, 0.008415222, -0.004962921, -0.0009832382, -0.027923584, 0.0015039444, -0.015914917, 0.023162842, -0.025650024, 0.009429932, -0.01878357, -0.009963989, 0.017288208, 0.014144897, -0.0008149147, -0.0036334991, -0.023590088, 0.013343811, 0.015602112, -0.016830444, -0.011726379, -0.008735657, 0.010093689, 0.005458832, 0.034118652, 0.024902344, -0.00047540665, -0.019165039, -0.037475586, -0.034698486, -0.029708862, 0.001074791, -0.04058838, -0.015945435, 0.016601562, -0.024795532, 0.012428284, 0.025161743, 0.044525146, -0.015991211, -0.060760498, -0.013114929, -0.008880615, -0.005748749, 0.02633667, -0.04046631, -0.02406311, -0.0030536652, -0.0033435822, -0.0077400208, -0.032836914, 0.0037822723, 0.041229248, -0.026611328, 0.013504028, 0.087524414, 0.08947754, -0.007663727, -0.08404541, -0.030349731, 0.0037288666, -0.03274536, -0.005870819, -0.019729614, 0.06689453, 0.013534546, 0.0014533997, 0.021575928, 0.014350891, 0.019454956, -0.009681702, 0.024627686, 0.0034618378, 0.018310547, -0.0027999878, 0.018569946, -0.021774292, -0.0134887695, -0.0927124, -0.061798096, 0.06286621, 0.07159424, -0.040924072, 0.025253296, 0.07080078, -0.016204834, -0.02178955, -0.008277893, -0.033477783, -0.008766174, 0.04815674, 0.056884766, 0.034362793, 0.03125, -0.0231781, -0.02607727, -0.0206604, -0.03353882, -0.010757446, -0.012397766, 0.024169922, -0.014091492, -0.020111084, -0.008911133, -0.014404297, -0.009849548, -0.004562378, 0.042785645, 0.021377563, -0.035736084]) # rubocop:disable Metrics/CollectionLiteralLength,Layout/LineLength
      create(:embeddings_similarity, embeddable: ideas[2], embedded_attributes: 'title',
        embedding: [0.01096344, 0.047546387, 0.012229919, 0.029556274, -0.0010633469, 0.012359619, -0.018066406, -0.040405273, 0.012557983, -0.007255554, -0.028427124, -0.01638794, 0.010002136, 0.018432617, -0.02142334, 0.017349243, -0.014381409, 0.053375244, -0.0035552979, -0.0126953125, 0.010772705, -7.134676e-05, -0.004032135, 0.05255127, -0.006713867, 0.045654297, 0.048339844, -0.039031982, 0.03125, -0.012321472, -0.026138306, -0.027572632, 0.067871094, 0.026260376, -0.050750732, -0.011566162, -0.06945801, -0.09906006, -0.012580872, 0.0927124, -0.03717041, -0.00920105, -0.036315918, 0.041168213, -0.0038318634, -0.025344849, 0.040924072, 0.049743652, -0.0068588257, 0.023468018, 0.009590149, 0.04385376, 0.001534462, -0.013870239, -0.008636475, 0.01725769, -0.008178711, -0.014701843, -0.009002686, -0.031555176, 0.02041626, 0.008163452, -0.032806396, 0.029418945, 0.014785767, 0.05831909, 0.023742676, 0.08770752, -0.009933472, 0.0015478134, 0.061401367, 0.070007324, 0.052978516, 0.018798828, 0.023071289, -0.016418457, 0.011924744, 0.04559326, 0.038391113, 0.037628174, -0.03744507, -0.020324707, 0.0051574707, -0.011558533, -0.030044556, -0.015113831, 0.010322571, -0.030014038, 0.021881104, -0.04736328, 0.0519104, 0.048675537, -0.013122559, -0.014816284, 0.00043201447, -0.02796936, -0.008544922, 0.013648987, 0.0055999756, 0.015388489, -0.037719727, -0.045288086, 0.014663696, -0.03451538, -0.0049362183, 0.017181396, -0.023498535, -0.010154724, -0.03741455, -0.006416321, 0.0022296906, 0.02331543, 0.0048179626, -0.0035800934, 0.015945435, 0.0038452148, -0.0056381226, -0.009117126, -0.010665894, 0.004310608, -0.03753662, 0.021835327, -0.04763794, -0.004928589, -0.0059776306, 0.064331055, 0.04522705, -0.041381836, -0.0026779175, -0.03265381, -0.03805542, -0.011856079, 0.011947632, 0.00907135, 0.023239136, -0.037017822, 0.01727295, -0.014602661, 0.010444641, 0.026107788, 0.008552551, 0.020965576, 0.0022697449, 0.023788452, -0.0014467239, 0.00090932846, -0.033111572, 0.05633545, 0.041137695, -0.024017334, -0.015174866, 0.123535156, 0.03805542, -0.025161743, -0.009262085, 0.0069389343, 0.0039978027, 0.00756073, 0.0028705597, 0.020401001, -0.040283203, -0.012611389, 0.024124146, -0.03213501, -0.011703491, -0.021240234, 0.009918213, -0.0062294006, 0.012145996, -0.008598328, 0.044799805, -0.007873535, 0.049621582, 0.011268616, -0.0030002594, -0.0038032532, -0.030456543, -0.0052108765, 0.042144775, -0.09039307, 0.028320312, 0.01675415, -0.00831604, 0.10455322, -0.05328369, -0.008735657, 0.0129470825, 0.010009766, 0.031799316, -0.00064849854, 0.012130737, -0.01184082, -0.01586914, 0.03967285, 0.014144897, 0.05670166, 0.03842163, -0.013290405, 0.0025806427, 0.022064209, 0.05331421, -0.017547607, 0.014091492, 0.009017944, 0.007789612, -0.008422852, 0.009231567, 0.018493652, -0.015731812, 0.003206253, -0.01864624, -0.0008430481, -0.0031280518, 0.0259552, 0.03930664, 0.014030457, 0.024353027, 0.04272461, -0.02041626, -0.024734497, 0.054138184, -0.03967285, 0.00932312, -0.008308411, -0.020477295, 0.0057792664, 0.03353882, -0.08679199, 0.05831909, -0.044158936, -0.043426514, -0.0062026978, 0.012191772, 0.004486084, 0.06555176, 0.018096924, 0.04937744, -0.007205963, -0.022079468, 0.007881165, -0.0022296906, 0.047668457, 0.0076560974, -0.022857666, -0.022460938, -0.003698349, -0.024032593, -0.05822754, -0.0014162064, 0.01864624, 0.005493164, 0.04006958, -0.017089844, 0.0006322861, 0.028320312, 0.041778564, -0.0052490234, -0.024093628, -0.022735596, -0.0211792, 0.01687622, -0.00068092346, 0.023162842, -0.0059890747, 0.012084961, 0.012702942, -0.00945282, -0.01826477, 0.028381348, -0.015899658, -0.0047569275, -0.013313293, 0.0041503906, 0.02633667, -0.008453369, 0.036590576, -0.038391113, 0.032226562, -0.034088135, 0.027328491, 0.034973145, -0.011695862, 0.018447876, 0.01259613, -0.08325195, -0.0496521, 0.030563354, -0.013008118, -0.0028972626, -0.0028762817, 0.047454834, -0.018310547, 0.0009775162, 0.014663696, -0.04437256, 0.020645142, 0.023162842, -0.014411926, -0.045562744, 0.011772156, -0.030975342, -0.008079529, 0.016677856, 0.007850647, 0.05126953, 0.022445679, -0.047302246, -0.0007367134, -0.014045715, -0.0038089752, 0.0030555725, 0.004436493, -0.03677368, -0.012901306, -0.022827148, 0.02482605, -0.032684326, -0.034698486, 0.015304565, -0.0060768127, -0.020004272, -0.0390625, -0.07208252, -0.0178833, -0.06738281, 0.064453125, 0.010345459, 0.0014038086, 0.01676941, 0.020324707, -0.0062828064, -0.0017080307, 0.0060157776, -0.01864624, 0.019042969, 0.022155762, 0.022018433, -0.002784729, 0.024642944, -0.022018433, -0.0690918, -0.011505127, 0.009132385, 0.0059547424, 0.041290283, 0.035064697, 0.009101868, -0.033294678, -0.009750366, -0.028579712, 0.0048065186, -0.007801056, -0.04937744, -0.021072388, 0.0151901245, 0.014816284, 0.0014715195, 0.024795532, -0.010101318, -0.0033512115, 0.010925293, -0.02067566, -0.008880615, 0.025009155, 0.0060272217, 0.033416748, -0.028152466, 0.0015897751, -0.0073280334, 0.018920898, -0.02557373, -0.011703491, -0.01586914, 0.011619568, -0.030166626, 0.009117126, 0.014091492, 0.003458023, -0.0062217712, 0.0109939575, -0.011436462, 0.021408081, 0.0077781677, 0.045532227, 0.017242432, 0.027786255, -0.0023002625, -0.017715454, -0.003276825, 0.009925842, 0.01889038, 0.018569946, 0.06347656, 0.043640137, 0.01878357, 0.031433105, 0.0256958, 0.05114746, 0.018630981, 0.013702393, -0.041656494, -0.002243042, -0.028717041, 0.007369995, -0.034942627, 0.028549194, -0.007091522, 0.011299133, 0.03173828, -0.028625488, -0.0064582825, -0.064208984, 0.004989624, -0.046661377, 0.05026245, -0.004211426, -0.030670166, -0.011566162, -0.038726807, -0.025527954, -0.016738892, -0.02368164, -0.04537964, -0.023101807, 0.0068893433, -0.020248413, 0.01071167, -0.016052246, 0.038726807, 0.002571106, 0.024505615, -0.005897522, 0.0073242188, -0.017074585, -0.042938232, 0.009361267, -0.04434204, 0.055511475, -0.01133728, 0.024734497, -0.009552002, 0.044769287, -0.013435364, 0.013641357, -0.05496216, 0.010345459, 0.039031982, 0.003168106, -0.06335449, 0.017654419, -0.038208008, 0.0022602081, 0.017745972, 0.012123108, -0.017608643, -0.007205963, 0.027877808, 0.009094238, 0.015777588, -0.03277588, -0.016738892, -0.014251709, -0.017349243, -0.04751587, 0.018188477, -0.0023593903, 0.061706543, 0.024520874, -0.0016880035, 0.03857422, -0.039001465, 0.05154419, -0.04550171, -0.031585693, 0.04208374, 0.047180176, -0.008148193, -0.0071029663, 0.015060425, -0.026489258, -0.03967285, 0.011245728, 0.05618286, 0.007095337, 0.009399414, 0.013626099, 0.0362854, 0.012077332, 0.07507324, -0.03466797, 0.011817932, 0.013031006, -0.029510498, -0.0042533875, 0.034698486, -0.049072266, 0.031433105, -0.028411865, 0.028320312, 0.019882202, 0.021972656, -0.005947113, 0.018600464, -0.05105591, -0.0051460266, -0.05218506, -0.03652954, 0.03451538, -0.012413025, 0.020019531, -0.012916565, -0.013587952, -0.012771606, 0.050994873, 0.00015592575, -0.01939392, 0.026107788, 0.037322998, 0.016296387, 0.00048351288, -0.022140503, -0.022583008, 0.03387451, 0.0057792664, 0.011436462, -0.012245178, -0.0056037903, 0.028030396, -0.0054969788, 0.019989014, -0.025726318, -0.043792725, 0.027557373, -0.0020599365, -0.013496399, -0.014457703, 0.015045166, 0.012268066, 0.030975342, 0.03451538, 0.014015198, 0.014709473, 0.015686035, 0.02267456, 0.029571533, -0.01398468, -0.046447754, -0.02128601, 0.0055122375, 0.021148682, -0.07086182, 0.026885986, -0.024093628, -0.027694702, -0.033447266, -0.016403198, -0.06573486, -0.009361267, 0.064941406, -0.031433105, -0.004383087, -0.08557129, -0.009017944, 0.06768799, -0.008331299, -0.008964539, -0.0345459, -0.013633728, -0.014091492, -0.033355713, 0.020370483, 0.0076904297, -0.0002399683, -0.0049438477, -0.016845703, 0.0051193237, 0.02154541, -0.061309814, -0.059692383, -0.024246216, -0.018814087, 0.033416748, 0.03326416, -0.0061950684, -0.00970459, -0.044189453, -0.006198883, -0.014160156, 0.0057868958, -0.0065078735, 0.036346436, -0.0018539429, 0.0016469955, -0.0046958923, -0.03390503, 0.027816772, -0.027297974, 0.015853882, 0.008560181, 0.011299133, 0.066223145, 0.018432617, -0.011581421, 0.005153656, -0.037628174, -0.02973938, 0.04449463, -0.056793213, 0.026489258, 0.049346924, 0.0051193237, -0.016204834, 0.018051147, -0.0018386841, -0.05621338, -0.002696991, 0.0048065186, 0.022491455, 0.009010315, -0.01374054, -0.022445679, -0.05718994, -0.04574585, 0.023452759, -0.03250122, -0.007896423, 0.044006348, 0.020736694, -0.10992432, -0.062683105, -0.039764404, -0.043548584, 0.0057373047, -0.06707764, -0.04522705, 0.000562191, 0.013420105, -0.011886597, -0.04248047, -0.018173218, 0.014137268, -0.031021118, 0.013717651, -0.030212402, 0.036193848, 0.0024929047, 0.028015137, -0.02330017, -0.010131836, -0.017745972, 0.032989502, -0.004764557, 0.039245605, -0.010406494, -0.029174805, 0.020141602, -0.020980835, 0.08618164, -0.012466431, 0.09466553, 0.0055656433, -0.025482178, 0.0022029877, 0.03643799, 0.010017395, -0.0050849915, -0.014152527, 0.03656006, 0.01247406, -0.04800415, 0.012413025, 0.012329102, 0.039764404, 0.0052375793, 0.024673462, 0.021987915, -0.013687134, 0.03149414, -0.036499023, 0.008476257, 0.016601562, 0.05593872, -0.03567505, -0.025497437, -0.01524353, -0.021514893, -0.037109375, -0.059020996, 0.011352539, -0.03414917, -0.00349617, 0.09088135, 0.031921387, 0.04525757, -0.03894043, 0.07324219, 0.04269409, 0.0054016113, -0.047424316, -0.0463562, -0.041168213, 0.049041748, -0.053649902, 0.0107803345, -0.0041656494, -0.005886078, 0.04473877, -0.03161621, 0.0423584, 0.012809753, -0.05758667, 0.04675293, 0.0127334595, -0.0026836395, -0.018814087, 0.015960693, 0.0024204254, -0.010505676, -0.0107040405, 0.019897461, 0.03262329, -0.020446777, -0.026107788, -0.070373535, 0.0105896, 0.012481689, 0.0074424744, -0.016174316, -0.010238647, 0.029434204, -0.0034713745, -0.009262085, 0.032409668, 0.022064209, -0.025680542, -0.0033473969, -0.0053596497, -0.009651184, 0.023956299, -0.014770508, 0.03189087, 0.026748657, -0.01979065, -0.06567383, -0.025054932, -0.011703491, -0.014755249, 0.02418518, -0.040924072, 0.0059928894, -0.0066947937, 0.035247803, 0.010124207, -0.005466461, 0.0008454323, -0.009246826, -0.012664795, -0.031585693, -0.07824707, -0.0033283234, 0.005962372, -0.055786133, 0.0025310516, 0.0028762817, -0.025894165, 0.027679443, -0.026641846, 0.00040721893, -0.0071411133, 0.049865723, -0.0039749146, 0.016036987, 0.018692017, -0.022064209, -0.044952393, -0.029754639, 0.05987549, -0.0051193237, 0.038238525, -0.01525116, -0.02658081, -0.04446411, 0.030929565, -0.027236938, 0.02142334, 0.0015258789, 0.027633667, 0.0065231323, 0.028671265, 0.022735596, 0.020217896, -0.022628784, 0.011650085, -0.022628784, -0.021820068, -0.04034424, 0.02154541, -0.053100586, -0.030639648, -0.048095703, 0.07952881, -0.006149292, -0.01574707, -0.016021729, 0.014022827, -0.027175903, -0.048706055, 0.053344727, 0.036468506, 0.0036678314, -0.04144287, 0.01109314, 0.049957275, 0.004535675, 0.046325684, 0.037628174, 0.058685303, 0.052490234, 0.057525635, 0.008346558, 0.028808594, 0.0023956299, -0.034423828, 0.039978027, 0.013664246, -0.035949707, 0.027160645, -0.009628296, -0.037994385, 0.03652954, 0.059417725, 0.02407837, -0.0023612976, -0.015258789, 0.010803223, -0.014404297, 4.1425228e-05, 0.03729248, 0.0211792, 0.0026855469, -0.0099487305, -0.012573242, -0.04144287, -0.0007004738, 0.025268555, 0.023452759, -0.0132369995, 0.021881104, 0.01725769, 0.08996582, -0.039886475, 0.011566162, 0.09838867, -0.04055786, -0.021408081, -0.03869629, -0.038024902, 0.07757568, 0.029754639, 0.062072754, 0.03515625, -0.04486084, 0.029525757, -0.05960083, 0.029876709, 0.00969696, -0.018188477, 0.013839722, 0.04449463, -0.02268982, -0.014076233, -0.0023593903, 0.09197998, -0.06463623, 0.021072388, -0.016067505, 0.0126571655, -0.04333496, -0.012313843, 0.0032138824, 0.03842163, -0.030548096, -0.029830933, -0.016738892, -0.008628845, 0.00068855286, -0.0017528534, 0.03213501, -0.013122559, 0.011230469, 0.04888916, 0.010055542, 0.035614014, -0.002954483, 0.002193451, -0.08123779, 0.040802002, -0.0014448166, -0.028167725, -0.026763916, -0.016220093, 0.008399963, 0.027679443, -0.008041382, 0.012626648, -0.022460938, 0.035064697, -0.0007276535, -0.002904892, -0.007396698, 0.027069092, 0.03427124, -0.02746582, -0.046569824, 0.03842163, -0.044921875, 0.018112183, -0.03125, -0.054473877, -0.012817383, -0.0209198, 0.019500732, 0.02470398, 0.0013237, -0.028701782, -0.03994751, 0.007698059, 0.023895264, -0.0680542, -0.010559082, -0.025177002, -0.017501831, 0.02696228, -0.017211914, -0.021591187, -0.0065727234, -0.005012512, -0.02470398, -0.0022182465, -0.012863159, 0.02558899, -0.0053367615, 0.000467062, 0.0074272156, 0.015014648, -0.011489868, 0.019195557, 0.020019531, 0.010498047, -0.012756348, -0.000228405, -0.011886597, 0.06896973, 0.0030918121, -0.08532715, 0.039489746, -0.018081665, -0.008575439, -0.006126404, -0.03970337, -0.027908325, 0.043273926, 0.02281189, -0.01953125, -0.08190918, 0.032165527, 0.03463745, -0.017807007, 0.011451721, 0.05026245, 0.016967773, -0.025650024, -0.050323486, 0.0004925728, -0.0015268326, -0.011268616, 0.0017175674, 0.0181427, 0.07373047, 0.03237915, 0.035461426, -0.0084991455, 0.039398193, 0.023498535, -0.021652222, 0.060546875, -0.012138367, -0.027740479, -0.0012750626, -0.04525757, -0.00434494, -0.0022029877, -0.03616333, -0.081604004, -0.016525269, 0.039001465, -0.028076172, -0.021835327, 0.009185791, 0.059661865, 0.012023926, 0.00491333, 0.039123535, -0.011375427, -0.020095825, 0.0014133453, 0.02330017, -0.024124146, -0.017166138, 0.014022827, -0.03729248, 0.04168701, -0.02973938, 0.0030269623, 0.012054443, -0.034576416, -0.028625488, -0.0008096695, -0.06335449, -0.022232056, 0.04244995, 0.030807495, 0.008407593, -0.019241333]) # rubocop:disable Metrics/CollectionLiteralLength,Layout/LineLength
    end

    it 'returns ideas more different from the exposed idea first' do
      create(:idea_exposure, idea: ideas[0], user:)
      previous_exposures = IdeaExposure.where(user:)
      candidates = Idea.where.not(id: ideas[0])
      result = service.generate_list(candidates, previous_exposures)

      expect(result.map(&:title_multiloc)).to eq([ideas[2].title_multiloc, ideas[1].title_multiloc])
    end

    it 'returns the most central candidate first when there are no exposed ideas yet' do
      previous_exposures = IdeaExposure.where(user:) # is empty
      candidates = Idea.all
      result = service.generate_list(candidates, previous_exposures)

      expect(result.map(&:id)).to eq([ideas[0].id, ideas[2].id, ideas[1].id])
    end

    it 'returns candidates that do not have embeddings at the end of the list, in the original order' do
      idea_without_embedding1 = create(:idea)
      idea_without_embedding2 = create(:idea, created_at: 1.day.ago)

      previous_exposures = IdeaExposure.where(user:) # is empty
      candidates = Idea.all
      result = service.generate_list(candidates.order(:created_at), previous_exposures)

      expect(result[-2]).to eq(idea_without_embedding2)
      expect(result[-1]).to eq(idea_without_embedding1)
    end

    it 'handles the case when seen ideas have no embeddings' do
      idea_without_embedding = create(:idea)
      create(:idea_exposure, idea: idea_without_embedding, user:)

      previous_exposures = IdeaExposure.where(user:)
      candidates = Idea.where.not(id: idea_without_embedding.id)
      result = service.generate_list(candidates, previous_exposures)

      expect(result).not_to be_empty
    end
  end
end
